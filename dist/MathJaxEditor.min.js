!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.MathJaxEditor=t():e.MathJaxEditor=t()}(this,function(){return function(e){function t(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return e[i].call(r.exports,r,r.exports,t),r.loaded=!0,r.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}([function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(1),o=i(a),u=n(6),l=i(u);window.addEventListener("load",l.default);var c=function(){function e(t){r(this,e);var n=new o.default(t);this.core=n,this.version="1.2.1"}return s(e,[{key:"blur",value:function(){this.core.blur()}},{key:"focus",value:function(){this.core.focus()}},{key:"insertCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.core.insertCommand(e,t,n)}},{key:"insert",value:function(e){if(!e.match(/[0-9]/)&&!e.match(/[a-z]/))throw new RangeError('Only numbers and variables are allowed in insert, not "'+e+'".');this.core.insert(e)}},{key:"insertSymbol",value:function(e){var t=["+","-","/","=","<",">",",",".",":",";","?","(",")","[","]","%"],n=["%"];if(!~t.indexOf(e))throw new RangeError('"'+e+'" is not a valid symbol.');return~n.indexOf(e)?void this.core.insertCommand("\\"+e):this.core.insert(e)}},{key:"getValue",value:function(){return this.core.value}},{key:"moveCursorLeft",value:function(){this.core.moveCursorLeft()}},{key:"moveCursorRight",value:function(){this.core.moveCursorRight()}},{key:"erase",value:function(){this.core.erase()}},{key:"on",value:function(e,t){this.core.on(e,t)}}]),e}();e.exports=c},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),a=n(2),o=i(a),u=n(3),l=i(u),c=n(4),d=i(c),h=n(5),f=8,m=13,v=37,p=39,y=46,b=function(){function e(t){var n=this,i=t.el,s=t.debug,a=void 0!==s&&s,u=t.focusClass,l=void 0===u?"isFocused":u,c=t.newLine,f=void 0!==c&&c,m=t.value,v=void 0===m?"":m;r(this,e);var p=MathJax.HTML.Element,y=(0,h.mustFindElement)(i),b=p("div",{className:"mj-ed-container"}),g=p("input",{className:"mj-ed-input"}),x=p("div",{className:"mj-ed-display"},["\\({\\cursor}"+v+"\\)"]),k=p("pre",{className:"mj-ed-debug"},["|"]);y.parentNode.replaceChild(b,y),b.appendChild(g),b.appendChild(x),b.appendChild(k),g.addEventListener("keydown",this.handleInputEvent.bind(this)),g.addEventListener("keyup",this.handleInputEvent.bind(this)),g.addEventListener("blur",this.blur.bind(this)),x.addEventListener("click",this.focus.bind(this)),document.body.addEventListener("click",this.handleBodyClick.bind(this)),x.style.opacity=0,k.style.display=a?"block":"none",MathJax.Hub.Queue(function(){return MathJax.Hub.Typeset(x)},function(){return n.jaxElement=MathJax.Hub.getAllJax(x)[0]},function(){x.style.opacity=1,x.style.minHeight=x.offsetHeight+"px",n.update({cursorHidden:!0})}),this.$container=b,this.$debug=k,this.$display=x,this.$input=g,this.bus=new o.default,this.cursor=0,this.placer=null,this.debug=a,this.focusClass=l,this.newLine=f,this.tex=new d.default(v),this.value=v,this.lastValue=v}return s(e,[{key:"update",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=this.value;n!==this.lastValue&&(this.tex=new d.default(n));var i=this.cursor,r=(0,h.insertBetween)(n,i,"{\\cursor}").replace(/\d/g,function(e){return"{"+e+"}"}).replace(/\,/g,function(e){return"{"+e+"}"}).replace(/\{\}/g,"{\\isEmpty}").replace(/\[\]/g,"[\\isEmpty]").replace(/\{\{\\cursor\}\}/g,"{{\\cursor}\\isEmpty}").replace(/\[\{\\cursor\}\]/g,"[{\\cursor}\\isEmpty]");this.debug&&(this.$debug.innerHTML=(0,h.insertBetween)(n,i,"|")),this.updateJaxElement(r,function(){setTimeout(function(){var t=new l.default(e);t.on("setCursor",function(t){e.debug&&console.log("The cursor should be placed at "+t+"."),e.cursor=t,e.update()}),e.placer=t},16),e.updateCursorElement(t)})}},{key:"updateJaxElement",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Function;MathJax.Hub.Queue(function(){return t.jaxElement.Text(e)},n)}},{key:"updateCursor",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=this.cursor,n=this.tex.cursorPoints,i=n.indexOf(t),r=t;e>0?r=n[i+1]:e<0&&(r=n[i-1]),this.cursor=r,this.update()}},{key:"updateCursorElement",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.cursorHidden||!1;MathJax.Hub.Queue(function(){var t=e.$display.querySelector(".mjx-cursor");t&&(t.style.marginLeft||(t.style.marginLeft="-"+t.offsetWidth+"px"),e._cursorRecentlyPlaced&&clearTimeout(e._cursorRecentlyPlaced),(0,h.addClass)(t,"wasRecentlyPlaced"),e._cursorRecentlyPlaced=setTimeout(function(){(0,h.removeClass)(t,"wasRecentlyPlaced")},600),t.style.display=n?"none":"inline-block")})}},{key:"findCommandAt",value:function(e){var t={start:null,end:null},n=this.value,i=(n.length,e-1),r=e+1,s=void 0;for(s=r;s--;)if(~["\\","^","_"].indexOf(n[s])){t.start=s;break}for(s=i;s++<n.length;){if("}"===n[s]&&"{"!==n[s+1]){t.end=s;break}if(" "===n[s-1]){t.end=s-1;break}}return null===t.end&&(t.end=s),t}},{key:"handleInputEvent",value:function(e){var t=this,n=this.$input,i=n.value.trim(),r=e.keyCode;if(n.value="","keyup"===e.type&&(r=null),!i.length)return this.handleInput(r);var s={"+":"+","-":"-","=":"=",",":",",".":".","*":"\\cdot ","/":"\\div "},a={char:/[\d\w]/};i.split("").forEach(function(e){(e.match(a.char)||s[e])&&(s[e]&&(e=s[e]),t.handleInput(r,e))})}},{key:"handleInput",value:function(e,t){switch(e){case v:return void this.moveCursorLeft();case p:return void this.moveCursorRight();case f:return void this.erase();case y:return void this.delete();case m:return void(this.newLine&&this.insert("\\\\"))}e&&this.debug&&console.warn("The key "+e+" was pressed."),t&&this.insert(t)}},{key:"moveCursorLeft",value:function(){this.cursor>0&&this.updateCursor(-1)}},{key:"moveCursorRight",value:function(){this.cursor<this.value.length&&this.updateCursor(1)}},{key:"handleBodyClick",value:function(e){this.placer&&this.placer.trigger("click",e)}},{key:"focus",value:function(){this.$input.focus(),this.updateCursorElement({hidden:!1}),this.bus.trigger("focus"),(0,h.addClass)(this.$display,this.focusClass)}},{key:"blur",value:function(){this.$input.blur(),this.updateCursorElement({hidden:!0}),this.bus.trigger("blur"),(0,h.removeClass)(this.$display,this.focusClass)}},{key:"insert",value:function(e){var t=this.cursor,n=this.value;this.cursor+=e.length,this.lastValue=this.value,this.value=(0,h.insertBetween)(n,t,e),this.update()}},{key:"insertCommand",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(this.focus(),n&&(e+="[]"),e+=t>0?"{":" ",this.insert(e),!(t<1)){var i=this.value,r=this.cursor,s="}"+"{}".repeat(t-1);this.lastValue=this.value,this.value=(0,h.insertBetween)(i,r,s),this.update()}}},{key:"erase",value:function(){var e=this.cursor,t=this.cursor-1,n=this.value,i=void 0,r=void 0;if(~["{","}"," "].indexOf(n[t])){var s=this.findCommandAt(e);i=n.slice(0,s.start),r=n.slice(s.end+1)}else{var a=e-1;"\\"===n[t]&&"\\"===n[t-1]&&(a-=1),i=n.slice(0,a),r=n.slice(e)}this.value=i+r,this.cursor=i.length,this.update()}},{key:"delete",value:function(){var e=this.cursor,t=this.cursor+1,n=this.value,i=void 0,r=void 0;if("\\"===n[e]&&"\\"!==n[t]||"}"===n[e]){var s=this.findCommandAt(e);i=n.slice(0,s.start),r=n.slice(s.end+1)}else{var a=e,o=t;"\\"===n[e]&&"\\"===n[t]&&(o+=1),i=n.slice(0,a),r=n.slice(o)}this.value=i+r,this.cursor=i.length,this.update()}},{key:"on",value:function(e,t){this.bus.on(e,t)}}]),e}();t.default=b},function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=function(){function e(){n(this,e),this.registry={}}return i(e,[{key:"on",value:function(e,t){this.registry[e]=(this.registry[e]||[]).concat(t)}},{key:"trigger",value:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];this.registry[e]&&this.registry[e].forEach(function(e){return e.apply(void 0,n)})}}]),e}();t.default=r},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),o=n(2),u=i(o),l=function(){function e(t){r(this,e);var n=new u.default;n.on("click",this.handleClick.bind(this)),this.$display=t.$display,this.bus=n,this.intervals=[],this.elements=t.tex.elements,this.findings={},this.tex=t.tex,this.iterate()}return a(e,[{key:"on",value:function(e,t){this.bus.on(e,t)}},{key:"trigger",value:function(e){for(var t,n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];(t=this.bus).trigger.apply(t,[e].concat(i))}},{key:"handleClick",value:function(e){var t=this,n=this.$display.getBoundingClientRect(),i=n.top,r=n.bottom,a=e.clientX,o=e.clientY,u=this.intervals,l=this.tex.length;if(!u.length||o>r||o<i)return!1;var c=!1;if(u.forEach(function(e,n){e.startX<=a&&a<e.endX&&e.startY<=o&&o<e.endY&&(c=!0,l=t.placeAtInterval(e,n,a,o))}),!c){var d=function(){var e={interval:null,distance:null,i:null};return u.forEach(function(t,n){if(t.startY<o&&o<t.endY){var i=Math.min(Math.abs(t.startX-a),Math.abs(t.endX-a));(null===e.distance||i<e.distance)&&(e.interval=t,e.distance=i,e.i=n)}}),e.interval?void(l=t.placeAtInterval(e.interval,e.i,a,o)):{v:!1}}();if("object"===("undefined"==typeof d?"undefined":s(d)))return d.v}this.bus.trigger("setCursor",l)}},{key:"getNextKeyFor",value:function(e){this.findings[e]=this.findings[e]||0;var t=this.findings[e];return this.findings[e]+=1,t}},{key:"addInterval",value:function(e){this.intervals.push(e)}},{key:"placeAtInterval",value:function(e,t,n,i){var r=this.intervals,s=e.endX-e.startX,a=t+1,o=e.index;return e.box?o:(n>e.startX+s/2&&(o=r[a]?r[a].index:this.tex.length),o)}},{key:"iterate",value:function(){var e=this;this.elements.forEach(function(t){switch(t.is){case"command":e.findCommand(t);break;default:e.find(t)}})}},{key:"find",value:function(e){var t=e.type,n=e.index,i=e.nearClosure,r=this.getNextKeyFor(t),s=this.$display.querySelectorAll(".mjx-"+t)[r];if(!s)return console.log("COULD NOT FIND THIS ELEMENT",s);var a=s.getBoundingClientRect(),o=a.left,u=a.right,l=a.top,c=a.bottom;this.addInterval({startX:o,endX:u,startY:l,endY:c,index:n}),i&&this.addInterval({index:n+1,top:0,bottom:0,left:0,right:0})}},{key:"findCommand",value:function(e){var t=this,n=e.type,i=(e.index,e.props),r=this.getNextKeyFor(n),s=this.$display.querySelectorAll(".mjx-m"+n)[r],a=i.brackets,o=i.blocks;switch(n){case"frac":var u=s.querySelector(".mjx-numerator"),l=s.querySelector(".mjx-denominator"),c=u.getBoundingClientRect(),d=l.getBoundingClientRect(),h=[c,d];h.forEach(function(e,n){var i=e.left,r=e.right,s=e.top,a=e.bottom;o[n].closeIndex-o[n].openIndex===1&&t.addInterval({index:o[n].closeIndex,startX:i,endX:r,startY:s,endY:a,box:!0})});break;case"root":case"sqrt":if(a&&a.closeIndex-a.openIndex===1){var f=s.querySelector(".mjx-root .mjx-char"),m=f.getBoundingClientRect(),v=m.left,p=m.right,y=m.top,b=m.bottom;this.addInterval({index:a.closeIndex,startX:v,endX:p,startY:y,endY:b,box:!0})}if(o[0].closeIndex-o[0].openIndex===1){var g=s.querySelector(".mjx-box"),x=g.getBoundingClientRect(),k=x.left,C=x.right,E=x.top,w=x.bottom;this.addInterval({index:o[0].closeIndex,startX:k,endX:C,startY:E,endY:w,box:!0})}}}}]),e}();t.default=l},function(e,t,n){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),s=n(5),a=["}","]","\\"],o={isNumber:/[0-9]/,isVariable:/[a-z]/,isOperator:/[\+\-\=\,\.\[\]]/,isEscapedOperator:/[\{\}]/},u=function(){function e(t){i(this,e),this.tex=t,this.cursorPoints=[],this.elements=[],this.length=t.length,this.parse()}return r(e,[{key:"parse",value:function(){for(var e=[],t=this.tex,n=this.tex.length,i=0;i<n;i++){var r=i,u=t[r],l=t[r+1],c=t[r-1],d=(0,s.isAny)(l,a);o.isNumber.exec(u)&&this.elements.push({is:"number",type:"mn",index:r,nearClosure:d}),o.isVariable.exec(u)&&this.elements.push({is:"variable",type:"mi",index:r,nearClosure:d}),o.isOperator.exec(u)&&this.elements.push({is:"operator",type:"mo",index:r,nearClosure:d}),o.isEscapedOperator.exec(u)&&"\\"===c&&this.elements.push({is:"operator",type:"mo",index:r,nearClosure:d}),"\\"===u&&"\\"===l&&(i+=1),"\\"===u&&o.isVariable.exec(l)&&(i=this.parseCommand(i)),(0,s.isAny)(u,["^","_"])&&(i=this.parseCommand(i)),"{"!==u&&e.push(r)}e.push(n),this.cursorPoints=e}},{key:"parseCommand",value:function(e){var t=e,n=this.tex,i=this.tex.length,r=null,u=[],l=null,c=0,d="",h="command",f=t,m=null,v=!1;for(e=t;e<i;e++){var p=n[e],y=n[e+1];if(null===r&&o.isVariable.exec(p)&&(d+=p),"["===p&&(l={openIndex:e},null===r&&(r=e)),"]"===p&&(l.closeIndex=e),"{"===p&&(0===c&&u.push({openIndex:e}),c+=1,null===r&&(r=e)),"}"===p&&(c-=1,0===c&&(u[u.length-1].closeIndex=e))," "===p){d=this.decideType(d),h="mo"===d?"operator":"variable",m=e,r=e,(0,s.isAny)(y,a)&&(v=!0);break}if("}"===p&&"{"!==y){m=e;break}}if("sqrt"===d&&null!==l&&(d="root"),null===r)throw new SyntaxError("Looks like this TeX is invalid. Now have a hard time finding where, lul.");return this.elements.push({is:h,type:d,nearClosure:v,props:{start:f,end:m,opening:r,blocks:u,brackets:l}}),r}},{key:"decideType",value:function(e){var t={alpha:"mi",beta:"mi",gamma:"mi",Gamma:"mi",delta:"mi",Delta:"mi",epsilon:"mi",varepsilon:"mi",zeta:"mi",eta:"mi",theta:"mi",vartheta:"mi",Theta:"mi",iota:"mi",kappa:"mi",lambda:"mi",mu:"mi",nu:"mi",xi:"mi",Xi:"mi",pi:"mi",Pi:"mi",rho:"mi",varrho:"mi",sigma:"mi",Sigma:"mi",tau:"mi",upsilon:"mi",Upsilon:"mi",phi:"mi",varphi:"mi",Phi:"mi",chi:"mi",psi:"mi",Psi:"mi",omega:"mi",Omega:"mi","%":"mi"};return t.hasOwnProperty(e)?t[e]:"mo"}}]),e}();t.default=u},function(e,t){"use strict";function n(e){var t=new Error("You must define a target element.");if(!e)throw t;if("string"==typeof e){var n=document.querySelector(e);if(!n)throw t;return n}return e}function i(e,t,n){var i=e.slice(0,t),r=e.slice(t);return i+n+r}function r(e,t){var n=e.className.split(" "),i="",r=!0,s=!1,a=void 0;try{for(var o,u=n[Symbol.iterator]();!(r=(o=u.next()).done);r=!0){var l=o.value;l!==t&&(i+=" "+l)}}catch(e){s=!0,a=e}finally{try{!r&&u.return&&u.return()}finally{if(s)throw a}}e.className=i.trim()}function s(e,t){var n=e.className.split(" ");~n.indexOf(t)||(e.className+=" "+t),e.className=e.className.trim()}function a(e){var t=[].slice;return t.call(e)}function o(e,t){return!!~t.indexOf(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.mustFindElement=n,t.insertBetween=i,t.removeClass=r,t.addClass=s,t.toArray=a,t.isAny=o},function(e,t,n){"use strict";function i(e){return e&&e.__esModule?e:{default:e}}function r(){var e=MathJax.InputJax.TeX,t=MathJax.ElementJax.mml;MathJax.Hub.processSectionDelay=0,MathJax.Hub.Register.StartupHook("TeX Jax Ready",function(){var n={mathvariant:t.INHERIT,mathsize:t.INHERIT,mathbackground:t.INHERIT,mathcolor:t.INHERIT,dir:t.INHERIT};e.Definitions.Add({macros:{cursor:"Cursor",isEmpty:"IsEmpty"}},null,!0),t.mcursor=t.mbase.Subclass({type:"cursor",isToken:!0,isSpacelike:function(){return!0},texClass:t.TEXCLASS.ORD,defaults:n}),t.misEmpty=t.mbase.Subclass({type:"isEmpty",isToken:!0,isSpacelike:function(){return!0},texClass:t.TEXCLASS.ORD,defaults:n}),e.Parse.Augment({Cursor:function(e){var n=t.mcursor("0");this.Push(n)},IsEmpty:function(e){var n=t.misEmpty("?");this.Push(n)}})}),MathJax.Ajax.Styles(a.default)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=r;var s=n(7),a=i(s)},function(e,t){"use strict";function n(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}Object.defineProperty(t,"__esModule",{value:!0});var i,r="from, to { border-color: #000 }\n 50% { border-color: transparent }";t.default=(i={".mjx-cursor":{"-webkit-animation":"1s mj-ed-blink step-end infinite","-moz-animation":"1s mj-ed-blink step-end infinite","-ms-animation":"1s mj-ed-blink step-end infinite","-o-animation":"1s mj-ed-blink step-end infinite",animation:"1s mj-ed-blink step-end infinite","border-right":"2px solid #000",color:"transparent"},".mjx-cursor.wasRecentlyPlaced":{"border-right-color":"#000 !important"},".mj-ed-input":{left:"-100%",position:"absolute",top:"-100%"},".mj-ed-display":{"box-sizing":"border-box"},".mj-ed-display *":{outline:"none"},".mj-ed-selectionButton":{cursor:"text"},".mjx-isEmpty":{color:"#ccc"},"@keyframes mj-ed-blink":r},n(i,"@keyframes mj-ed-blink",r),n(i,"@-moz-keyframes mj-ed-blink",r),n(i,"@-webkit-keyframes mj-ed-blink",r),n(i,"@-ms-keyframes mj-ed-blink",r),n(i,"@-o-keyframes mj-ed-blink",r),i)}])});